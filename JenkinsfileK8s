pipeline {
  agent any
  stages {
    stage('Parse Input File') {
      steps {
        script {
          DOMAINS = readJSON file: 'domains.json'
          for (i=0; i < DOMAINS.size(); i++) {
            echo DOMAINS[i].name
            build(
              job: 'WEB/ruggedsecurity/gauntlt-tests/master',
              propagate: false,
              parameters: [
                [
                    $class: 'StringParameterValue',
                    name: 'HOST',
                    value: DOMAINS[i].name
                ]
              ]
            )
          }
        }
      }
    }
  }
}
